<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>CS Manager System</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Gobet">
    <link rel="shortcut icon"  href="/favicon.ico">
    <link  href="./css/bootstrap.css" rel="stylesheet">
         <link rel="stylesheet" href="./plugin/bootstrapTable-treeView-master/assets/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="./plugin/bootstrapTable-treeView-master/assets/bootstrap-table.css">
    <link  href="./css/theme.css" rel="stylesheet">
    <link  href="./css/font-awesome.min.css" rel="stylesheet">
    <link  href="./css/alertify.css" rel="stylesheet">
 
     <link href="./group-structure/css.css" type="text/css" rel="stylesheet" />
    <style>
    	/** tree.css zyj 2018.4.21 */
ul,li{list-style-type:none;}
.tree{display:block;position:relative;padding:5px 15px;}
.tree span{display:inline-block;box-sizing:border-box;height:30px;line-height:28px;min-width:60px;text-align:center;color:#888;border:1px solid #ddd;border-radius:5px;padding:0 8px;}
.tree ul{position:relative;padding-left:60px;margin:0;}
.tree ul>li{position:relative;padding:5px 0;}
.tree>ul{padding:0;margin:0;}
/** 水平方向连线 */
.tree>ul ul>li:after{content:' ';position:absolute;top:20px;left:-45px;width:45px;border:none;border-top:1px solid #ddd;}
/** 垂直方向连线 */
.tree ul>li:not(:last-child):before{content:' ';position:absolute;top:0;left:-45px;height:100%;border:none;border-left:1px solid #ddd;}
.tree ul>li:last-child:before{content:' ';position:absolute;top:0;left:-45px;height:20px;border:none;border-left:1px solid #ddd;}
/** 控制鼠标移上去的颜色 */
.tree span:hover, .tree span:hover+ul span{color:#fff;background-color:orange;}
.tree span:hover, .tree span:hover+ul span, .tree span:hover+ul li:before, .tree span:hover+ul li:after{border-color:orange;}
/** 折叠图标 */
.tree .fa:before{margin-right:5px;}
.tree .fa-minus-circle, .tree .fa-plus-circle{cursor:pointer;}
    </style>
</head>
<body>
<div id="wrap">
	<!--HEADER-->
    <div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container-fluid">
					<div class="logo"> 
						<img  src="./images/logo.png" alt="Admin" style="height:40px;">
					</div>
					 <a class="btn btn-navbar visible-phone" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					 <a class="btn btn-navbar slide_menu_left visible-tablet">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>

					<div class="top-menu visible-desktop">
						
						<ul class="pull-right">  
							<li><a href="#"><i class="icon-off"></i> 安全退出(Logout)</a></li>
						</ul>
					</div>

					<div class="top-menu visible-phone visible-tablet">
						<ul class="pull-right">  
							<li><a href="#"><i class="icon-off"></i></a></li>
						</ul>
					</div>

				</div>
			</div>
		</div> 
     <!--HEADER-->
    <div class="container-fluid">
     
    <!-- Side menu -->
    <div class="sidebar-nav nav-collapse collapse">
        <div class="user_side clearfix">
        <img  src="./images/tx.png" alt="Admin">
          <h5>ADMIN</h5>
          <a href="#"><i class="icon-cog"></i>尊敬的<b>ADMIN</b></a>        
        </div>
        <div class="accordion" id="accordion2">
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle active b_F79999" href="index.html"><i class="icon-dashboard"></i> <span>系统首页</span></a>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_C3F7A7  collapsed1 " data-toggle="collapse" data-parent="#accordion2" href="#collapse1"><i class="icon-user"></i> <span>业务管理</span></a>
            </div>
            <div id="collapse1" class="accordion-body collapse"  menu1 >
              <div class="accordion-inner">           
                <a class="accordion-toggle" href="zc.html"><i class="icon-star"></i> 会员注册</a>            
                <a class="accordion-toggle" href="gw.html"><i class="icon-circle"></i> 物流信息</a>
                <a class="accordion-toggle" href="bmyj.html"><i class="icon-list-alt"></i> 部门业绩</a>
    <!--            <a class="accordion-toggle" href="tjgx.html"><i class="icon-table"></i> 推荐管理</a>-->
                <a class="accordion-toggle " href="jfmx.html"><i class="icon-rss"></i> 奖金查询</a>
                <a class="accordion-toggle " href="fill.html"><i class="icon-picture"></i> 微店查询</a>
    <!--            <a class="accordion-toggle" href="sqgb.html"><i class="icon-calendar"></i> 申请购币</a>-->
              </div>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_9FDDF6  collapsed2 " data-toggle="collapse" data-parent="#accordion2" href="#collapse2"><i class="icon-reorder"></i> <span>财务管理</span></a>
            </div>
            <div id="collapse2" class="accordion-body collapse"  menu2>
              <div class="accordion-inner">
                <a class="accordion-toggle" href="jfmr.html"><i class="icon-calendar"></i> 电子币账户</a>
    <!--            <a class="accordion-toggle " href="jfjf.html"><i class="icon-list-alt"></i> 消费币转帐</a>-->
                <a class="accordion-toggle" href="jfmc.html"><i class="icon-picture"></i> 电子币转帐</a> 
                <a class="accordion-toggle" href="jfzzc.html"><i class="icon-star"></i> 佣金转电子币</a>
                <a class="accordion-toggle" href="xt.html"><i class="icon-table"></i> 提现</a>
              </div>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_F6F1A2" href="gg.html"><i class="icon-tasks"></i> <span>公司公告</span></a>
            </div>
          </div>
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_C1F8A9" href="ly.html"><i class="icon-bar-chart"></i> <span>留言咨询</span></a>
            </div>
          </div> 
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_9FDDF6" href="grzl.html"><i class="icon-bullhorn"></i> <span>个人资料</span></a>
            </div>
          </div> 
          <div class="accordion-group">
            <div class="accordion-heading">
              <a class="accordion-toggle b_F5C294" href="#"><i class="icon-magic"></i> <span>安全退出</span></a>
            </div>
          </div>      
        </div>
      </div>
    <!-- /Side menu -->

      <!-- Main window -->
      <div class="main_container" id="tables_page">
			
        <div class="row-fluid">
          <ul class="breadcrumb">
				<li><a href="main.html">系统首页</a> <span class="divider">/</span></li>
                <li><a href="#">业务管理</a> <span class="divider">/</span></li>
                <li class="active">奖金明细</li>
          </ul>
          <h2 class="heading">奖金明细</h2>
        </div>          

		 <div class="row-fluid">
            <div class="widget widget-padding span12">
              <div class="widget-header"> <i class="icon-group"></i>
                <h5>奖金明细</h5>
                <div class="widget-buttons"><a href="#" data-title="隐藏" data-collapsed="false" class="tip collapse"><i class="icon-chevron-up"></i></a> </div>
              </div>
              <div class="widget-body">
                <div style="margin:20px">
					        <input type="button" id="expandAllTree" value="展开所有"  class="btn btn-primary"/>
					        <input type="button" id="collapseAllTree" value="折叠所有" class="btn btn-defaul"/>
					         <input type="button" id="orgTree" value="组织结构" class="btn btn-defaul"/>
					        <table id="tree_table"></table>
					
					    </div>
                 
              </div>
              <!-- /widget-body -->
            </div>
            <!-- /widget -->
          </div>
        </div>
			<!--main-->
    </div> 
    
   </div>
   <div style='width:100%;left:0;top:0;margin-left:0;height:100%' id="example_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">组织结构</h3>
      </div>
      <div style='max-height: calc(100% - 111px);height: calc(100% - 111px);' class="modal-body">
      	 <div class="strt-wrap" id="strtWrap">
				    <div class="tree">
     
						</div>
      	 </div>
 
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>                 
      </div>
    </div> 
     <script type="text/javascript" src="./js/jquery.min.js"></script>
     <script type="text/javascript" src="./js/bootstrap.js"></script>
    <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./js/bootstrap.js"></script>
    <script type="text/javascript" src="./js/tooltips.js"></script>
   <!--折叠面板-->
   <script type="text/javascript" src="./js/realm.js"></script>
    <script src="./plugin/bootstrapTable-treeView-master/assets/bootstrap-table.js"></script>
    <script src="./plugin/bootstrapTable-treeView-master/src/bootstraptable-treeview.js"></script>
    
    <script src="./group-structure/jquery.ui.draggable.min.js" type="text/javascript"></script>
   <script src="./group-structure/tree.js" type="text/javascript"></script>
    <script>
     
    	
        $(function () {
        	var dataTest = {
							name:'拉莫小学', 
							children:[
							   {
							       name:'一年级',
							       children:[
							           {name:'一班'},
							           {name:'二班'}
							       ]
							   },
							   {
							       name:'二年级'
							   },
							   {
							       name:'三年级',
							       children:[
							           {name:'一班'},
							           {name:'二班'},
							           {name:'三班'}
							       ]
							   }
							]
							};

tree.setData('.tree', dataTest);
 $('#example_modal').modal({backdrop: 'static', keyboard: false})
            var data = [
               {
                    id: '0',
                    name: "龙哥",
                    desc: "这是一个描述",
                    parentId:null,
               },
                {
                    id: '1',
                    name: "aa",
                    desc: "这是一个描述",
                    parentId:0,
                },{
                    id: '11',
                    name: "aa_sub1",
                    desc: "这是一个描述_sub1",
                    parentId:'1',
                },{
                    id: '111',
                    name: "3",
                    desc: "3" ,
                    parentId:'11',
                },
                {
                    id: '112',
                    name: "4",
                    desc: "4",
                    parentId:'11',
                },
                {
                    id: '113',
                    name: "5",
                    desc: "5",
                    parentId:'11',
                },
                {
                    id: '2',
                    name: "bb",
                    desc: "这是一个描述",
                    parentId:0,
                },
                {
                    id: '22',
                    name: "bb_sub1",
                    desc: "这是一个描述_sub1",
                    parentId:'2',
                },{
                    id: '23',
                    name: "bb_sub2",
                    desc: "这是一个描述_sub2",
                    parentId:'2',
                },{
                    id: '233',
                    name: "bb_sub2_sub2",
                    desc: "这是一个描述_sub2_sub2",
                    parentId:'23',
                },{
                    id: '2333',
                    name: "bb_sub2_sub2_sub2",
                    desc: "这是一个描述_sub2_sub2_sub2",
                    parentId:'233',
                },{
                    id: '23333',
                    name: "bb_sub2_sub2_sub23",
                    desc: "这是一个描述_sub2_sub2_sub2",
                    parentId:'233',
                },{
                    id: '233333',
                    name: "bb_sub2_sub2_sub233",
                    desc: "这是一个描述_sub2_sub2_sub2",
                    parentId:'233',
                },{
                    id: '24',
                    name: "bb_sub3",
                    desc: "这是一个描述_sub3",
                    parentId:'2',
                },
            ]
      
           
            
            //$("body").append(menus);
        move()
       
				function getRoot(id,array,name){
					   var menus = "";
						menus+='<div class="strt-block"><div class="strt-part"><span class="strt-name">'+name+'</span><div class="line-v"><span></span></div>';
						GetData(id,array)
						menus+='</div>'
						
        	  $('#example_modal').modal({backdrop: 'static', keyboard: false}).on('shown.bs.modal', function () {
               
               	$('#strtWrap').html(menus);
               	 var strtWrap=$("#strtWrap");
					strtWrap.width(strtWrap.children().width());
					console.log(strtWrap.children().width())
              
              }).on('hidden.bs.modal', function () {
							  $('#strtWrap').html('')
							    	 var strtWrap=$("#strtWrap");
					strtWrap.width('auto');
							})
				}
				
        function GetData(id,array) {
          var childArray = GetParentData(id,array);
           var arrayIndex=0;
					

          if(childArray.length > 0){ //如果有值，采用递归得到他的子元素
          	 menus+='<div class="strt-block">';
          	 for(var i in childArray) {
							 var array1=GetParentData(childArray[i].id,array);
							 var childArray1 = GetParentData(childArray[i].id,array);
          	 	  if(childArray.length==1){
          	 	  	     menus += '<div class="strt-part">'
											+'<span class=""></span>'
											+'<span class="strt-name">'+childArray[i].name+'</span>';
										   menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';
											 if(array1.length>0){
												 GetData(childArray[i].id,array);

											 }
											
											 menus+='</div>'
          	 	      	
          	 	   }
								 //只有左右的情况
          	 	  else if(childArray.length==2){
									//左
          	 	   	   if(arrayIndex==0){
	          	 	   	   menus += '<div class="strt-part">'
												+'<span class="line-h line-h-r"></span>'
												+'<div class="line-v"><span></span></div>';
												+'<span class="strt-name">'+childArray[i].name+'</span>'
											  menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';
												  if(array1.length>0){
												 												 GetData(childArray[i].id,array);
												 
												 											 }
												 menus+='</div>'
          	 	      }
										//右
          	 	   	   else{
          	 	   	   	  menus += '<div class="strt-part">'
												+'<span class="line-h line-h-l"></span>'
												+'<div class="line-v"><span></span></div>';
												+'<span class="strt-name">'+childArray[i].name+'</span>'
											   menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';
													 if(array1.length>0){
															 GetData(childArray[i].id,array);
			
														 }
													menus+='</div>'
          	 	   	   }
          	 	   	   
          	 	   }
          	 	   else{
									 //左
          	 	   	  if(arrayIndex==0){
	          	 	   	   menus += '<div class="strt-part">'
												+'<span class="line-h line-h-r"></span>'
												+'<div class="line-v"><span></span></div>'
												+'<span class="strt-name">'+childArray[i].name+'</span>'
											  menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';

												 if(array1.length>0){
														 GetData(childArray[i].id,array);
		
													 }
												 menus+='</div>'
          	 	      }
										//右
          	 	   	  else if( arrayIndex==childArray.length-1){
											//console.log(childArray[i].name)
											 
          	 	   	  	  menus += '<div class="strt-part">'
												+'<span class="line-h line-h-l"></span>'
												+'<div class="line-v"><span></span></div>'
												+'<span class="strt-name">'+childArray[i].name+'</span>'
											  menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';
                         if(array1.length>0){
														 GetData(childArray[i].id,array);
		
													 }
													menus+='</div>'
											   	 
          	 	   	  }
										//中
          	 	   	   else{
          	 	   	   	    menus += '<div class="strt-part">'
												+'<span class="line-h line-h-c"></span>'
												+'<div class="line-v"><span></span></div>'
												+'<span class="strt-name">'+childArray[i].name+'</span>'
											  menus+=array1.length>0?'<div class="line-v"><span></span></div>':'';

													if(array1.length>0){
															GetData(childArray[i].id,array);
			
														}
													menus+='</div>'
											   	
          	 	   	   }
          	 	   	  
          	 	   }
          	 	   arrayIndex++
          	 	    
	            }
	             menus += '</div>';     
          }
            
         
					//console.log(menus)
        }
 
        function GetParentData(id,array) {
          var newArray = [];
          for(var i in array) {
          	 
            if(array[i].parentId == id)
              newArray.push(array[i]);
          }
          return newArray;
        }
        function move(){
        	var strtBlocks=$("div.strt-block");
					strtBlocks.each(function(n){
						var childs=$(this).children();
						var w=(childs.last().width() - childs.first().width())/4;
						if(w>0){
							$(this).css("margin-left",w)
						}else{
							$(this).css("padding-right",-w*2);
						}
					});
					
					var strtWrap=$("#strtWrap");
					strtWrap.width(strtWrap.children().width());
					console.log(strtWrap.children().width())
					strtWrap.draggable({
						cursor:"move",
						opacity:0.5
					});
       }
 
       
            $('#tree_table').bootstrapTable({
                class: 'table table-hover table-bordered',
               // url:'plugin/bootstrapTable-treeView-master/data.json',
                contentType: 'application/x-www-form-urlencoded; charset=utf-8',
                data: data,
                sidePagination: 'server',
                pagination: false,
                hideColumn:0,
                treeView: true,
                treeId: "id",
                treeField: "name",
                rowAttributes: function (row, index) {
                    return {
                        xx:index
                    };
                },
                onClickRow:function(row,index){
                	//console.log(row)
									 
								 
									getRoot(row.id,data,row.name);
								 
                
  
                },
                queryParams : function(params) {
									var param = {
										roleId : 'xx'
									};
									return param;
								},
                columns: [ {
                    field: 'name',
                    title: '名称',
                },
                {
                    field: 'desc',
                    title: '详情',
                },
                ]
            });
            $("#expandAllTree").on('click',function(){
                $('#tree_table').bootstrapTable("expandAllTree")
            })
            $("#collapseAllTree").on('click',function(){
                $('#tree_table').bootstrapTable("collapseAllTree")
            })
            $('#orgTree').on('click',function(){
            	   getRoot(0,data,data[0].name)
            })
        });
    </script>
  </body>
</html>